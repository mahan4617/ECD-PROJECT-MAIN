{% extends 'base.html' %}
{% load static %}

{% block navbar %}{% endblock %}
{% block content %}
<div class="dashboard-body">
  <aside class="sidebar">
    <div class="sidebar-header d-flex align-items-center gap-2 mb-4">
      <i class="bi bi-lock-fill text-primary"></i>
      <a href="/" class="text-decoration-none fw-semibold">SecureCloud</a>
    </div>
    <nav class="nav flex-column">
      <a href="{% url 'dashboard' %}" class="nav-link active"><i class="bi bi-grid-1x2 me-2"></i>Dashboard</a>
      <a href="{% url 'upload' %}" class="nav-link"><i class="bi bi-cloud-upload me-2"></i>Upload</a>
      <a href="{% url 'file_list' %}" class="nav-link"><i class="bi bi-files me-2"></i>History</a>
      <a href="{% url 'profile' %}" class="nav-link"><i class="bi bi-person me-2"></i>Profile</a>
    </nav>
    <div class="mt-auto">
      <a href="{% url 'logout' %}" class="btn btn-outline-danger w-100 mb-3">
        <i class="bi bi-box-arrow-right me-1"></i> Logout
      </a>
    </div>
  </aside>

  <main class="main-content">
    <div class="page-header mb-4">
      <h1 class="page-title">Dashboard</h1>
      <p class="text-muted mb-0">Overview of your secure cloud storage</p>
    </div>
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}
    {% endif %}

    <div class="row g-4 mb-4">
      <div class="col-md-4">
        <div class="card h-100">
          <div class="card-body">
            <div class="d-flex align-items-center gap-3">
              <div class="card-icon"><i class="bi bi-clipboard"></i></div>
              <div>
                <div class="card-label">Files Uploaded</div>
                <div class="card-value">{{ total_files }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card h-100">
          <div class="card-body">
            <div class="d-flex align-items-center gap-3">
              <div class="card-icon"><i class="bi bi-clock-history"></i></div>
              <div>
                <div class="card-label">Last Login</div>
                <div class="card-value">
                  {% if last_login %}{{ last_login|timesince }} ago{% else %}-{% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card h-100">
          <div class="card-body">
            <div class="d-flex align-items-center gap-3">
              <div class="card-icon"><i class="bi bi-shield-lock"></i></div>
              <div>
                <div class="card-label">Security Status</div>
                <div class="card-value">Secure</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="table-container">
      <h5 class="mb-3">Recent Files</h5>
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead>
            <tr>
              <th>File Name</th>
              <th>Status</th>
              <th>Size</th>
              <th>Upload Date</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for f in recent_files %}
            <tr>
              <td class="fw-medium">{{ f.original_name }}</td>
              <td><span class="badge bg-success bg-opacity-10 text-success">Encrypted</span></td>
              <td>
                <span class="badge bg-dark text-light border border-secondary">
                  {% if f.data_length %}{{ f.data_length|filesizeformat }}{% else %}-{% endif %}
                </span>
              </td>
              <td>{{ f.created_at|date:"Y-m-d" }}</td>
              <td class="text-end">
                <a href="{% url 'download' f.pk %}" class="btn btn-sm btn-outline-primary">
                  <i class="bi bi-download"></i> Download
                </a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" class="text-center text-muted py-5">
                No recent files
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </main>
</div>

<style>
.dashboard-body{display:flex;min-height:100vh;background-color:#0f0f12}
.sidebar{width:260px;border-right:1px solid #1e293b;padding:1rem 1rem 0;color:#e5e7eb;display:flex;flex-direction:column}
.nav-link{color:#cbd5e1}
.nav-link.active{color:#ffffff;font-weight:600}
.main-content{flex:1;padding:2rem;color:#e5e7eb}
.page-title{color:#ffffff}
.text-muted{color:#cbd5e1 !important}
.card-icon{width:48px;height:48px;border-radius:12px;background-color:rgba(13,110,253,.15);display:flex;align-items:center;justify-content:center;font-size:1.4rem;color:#5aa2ff}
.card-label{color:#e2e8f0}
.card-value{color:#ffffff}
.table-container{border:1px solid #3b3f45;border-radius:.75rem;padding:1rem;background-color:#0f1115;color:#e5e7eb}
</style>
{% endblock %}
